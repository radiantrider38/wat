<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAT Master | ISSB Psychology Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
        }
        .montserrat { font-family: 'Montserrat', sans-serif; }
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .hidden { display: none !important; }
        .nature-positive { color: #34d399; background: rgba(52, 211, 153, 0.1); border-color: rgba(52, 211, 153, 0.2); }
        .nature-negative { color: #fb7185; background: rgba(251, 113, 133, 0.1); border-color: rgba(251, 113, 133, 0.2); }
        .nature-neutral { color: #fbbf24; background: rgba(251, 191, 36, 0.1); border-color: rgba(251, 191, 36, 0.2); }
        
        @keyframes pulse-red {
            0%, 100% { border-color: #ef4444; color: #ef4444; }
            50% { border-color: #7f1d1d; color: #7f1d1d; }
        }
        .timer-critical { animation: pulse-red 1s infinite; }
        
        /* Smooth transitions */
        #report-area {
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        .opacity-0 { opacity: 0; transform: translateY(20px); }
        .opacity-100 { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="text-slate-200 min-h-screen overflow-x-hidden">
    <div class="min-h-screen flex flex-col items-center justify-start p-4 md:p-8">
        <!-- Header -->
        <header class="w-full max-w-4xl flex justify-between items-center mb-12">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-indigo-500/20">
                    <span class="text-white font-bold text-xl">W</span>
                </div>
                <h1 class="montserrat text-2xl font-bold tracking-tight text-white">WAT MASTER</h1>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <label class="text-sm text-slate-400 cursor-pointer select-none" for="timed-mode-toggle">Timed Practice</label>
                    <button id="timed-mode-toggle" class="w-10 h-5 rounded-full transition-colors relative bg-slate-700">
                        <div id="toggle-knob" class="absolute top-1 w-3 h-3 bg-white rounded-full transition-all left-1"></div>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main UI -->
        <main class="w-full max-w-4xl flex flex-col items-center gap-12">
            
            <!-- Flashcard Input Area -->
            <section id="input-section" class="w-full max-w-2xl transition-all duration-500 transform translate-y-24">
                <div class="glass-panel p-8 rounded-3xl shadow-2xl relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-br from-indigo-500/5 to-transparent pointer-events-none"></div>
                    
                    <form id="wat-form" class="relative z-10">
                        <label class="block text-slate-400 text-xs uppercase tracking-widest font-semibold mb-3">Target Word</label>
                        <div class="relative">
                            <input 
                                id="word-input"
                                type="text"
                                autofocus
                                placeholder="Enter Word..."
                                class="w-full bg-slate-900/50 border-2 border-slate-700 focus:border-indigo-500 text-3xl md:text-5xl font-bold py-6 px-8 rounded-2xl outline-none transition-all placeholder:text-slate-800 text-white montserrat"
                            />
                            <button 
                                id="analyze-btn"
                                type="submit"
                                class="absolute right-4 top-1/2 -translate-y-1/2 px-6 py-3 bg-indigo-600 hover:bg-indigo-500 disabled:bg-slate-700 text-white rounded-xl font-bold transition-all shadow-lg"
                            >
                                ANALYZE
                            </button>
                        </div>
                        <p class="mt-4 text-slate-500 text-sm">Hit Enter to see the psychologist's breakdown.</p>
                    </form>
                </div>
            </section>

            <!-- Timer Overlay -->
            <div id="timer-container" class="fixed top-8 left-1/2 -translate-x-1/2 z-50 hidden">
                <div id="timer-circle" class="w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold border-4 border-indigo-500 bg-slate-900 shadow-xl text-indigo-400">
                    10
                </div>
            </div>

            <!-- Report Area -->
            <div id="report-area" class="w-full space-y-6 hidden opacity-0">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="md:col-span-2 space-y-6">
                        <div class="glass-panel p-6 rounded-2xl border-l-4 border-indigo-500">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-indigo-400 font-bold tracking-wider uppercase text-xs">Psychological Profile</h3>
                                <div id="nature-badge" class="px-3 py-1 rounded-md text-[10px] font-bold border uppercase tracking-wider"></div>
                            </div>
                            <h2 class="text-xl font-semibold mb-2 text-white">Why this word?</h2>
                            <p id="nature-reasoning" class="text-slate-400 leading-relaxed text-sm"></p>
                            
                            <div class="mt-6">
                                <h4 class="text-xs font-semibold text-slate-500 mb-3 uppercase tracking-widest">Core OLQs Tested</h4>
                                <div id="olq-container" class="flex flex-wrap gap-2"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-6 rounded-2xl">
                            <h3 class="text-emerald-400 font-bold tracking-wider uppercase text-xs mb-4">Correct Thinking Direction</h3>
                            <div class="flex gap-4 items-center mb-4">
                                <div class="w-12 h-12 rounded-full bg-slate-800 flex items-center justify-center text-2xl">üß†</div>
                                <div class="h-[2px] w-8 bg-slate-700"></div>
                                <div class="w-12 h-12 rounded-full bg-emerald-500/20 text-emerald-500 flex items-center justify-center text-2xl shadow-inner border border-emerald-500/30">‚öîÔ∏è</div>
                            </div>
                            <p id="thinking-direction" class="text-slate-300 font-medium italic"></p>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-slate-800/50 p-6 rounded-2xl border border-slate-700/50 h-full">
                            <h3 class="text-amber-400 font-bold tracking-wider uppercase text-xs mb-4">Sentence Formula</h3>
                            <p id="formula" class="text-sm text-slate-200 mb-4 bg-slate-900 p-3 rounded-lg border border-slate-800"></p>
                            <h4 class="text-xs font-semibold text-rose-400 mb-2 uppercase tracking-widest">Avoid at all costs</h4>
                            <ul id="avoid-list" class="space-y-1"></ul>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="glass-panel p-6 rounded-2xl bg-rose-500/5 border-rose-500/20">
                        <h3 class="text-rose-400 font-bold tracking-wider uppercase text-xs mb-4">Rejected Thinking (Weak)</h3>
                        <div id="weak-responses" class="space-y-4"></div>
                    </div>

                    <div class="md:col-span-2 glass-panel p-6 rounded-2xl bg-indigo-600/10 border-indigo-500/40 border-2 relative">
                        <div class="absolute -top-3 -right-3 bg-indigo-500 text-white text-[10px] font-bold px-3 py-1 rounded-full shadow-lg">RECOMMENDED DRILLS</div>
                        <h3 class="text-indigo-400 font-bold tracking-wider uppercase text-xs mb-4">Ideal Officer Responses</h3>
                        <div id="ideal-responses" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                        <p class="text-xs text-slate-500 mt-6 pt-4 border-t border-slate-700/50">These responses are natural, demonstrate leadership initiative, and avoid passive descriptions.</p>
                    </div>
                </div>

                <div class="w-full py-8 flex justify-center">
                    <button id="next-word-btn" class="group flex items-center gap-3 text-indigo-400 hover:text-white transition-all font-semibold">
                        Shall we move to the next word?
                        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Session History -->
            <div id="history-container" class="w-full max-w-2xl hidden">
                <h4 class="text-xs font-bold text-slate-600 uppercase tracking-[0.2em] mb-4 text-center">Recent Sessions</h4>
                <div id="history-list" class="flex flex-wrap justify-center gap-3"></div>
            </div>

        </main>

        <footer class="mt-auto py-8 text-slate-600 text-[10px] uppercase tracking-widest font-bold">
            ISSB Psychological Training Engine v1.0
        </footer>
    </div>

    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.run/@google/genai"
      }
    }
    </script>
    <script type="module">
        import { GoogleGenAI, Type } from "@google/genai";

        // Constants
        const SYSTEM_INSTRUCTION = `You are a Senior ISSB Psychologist and Officer Selection Trainer. Your expertise lies in evaluating candidates for the Armed Forces through the Word Association Test (WAT). Your goal is to guide candidates on how to think like an officer when they see a word, focusing on spontaneous, positive, and action-oriented psychology.

        For every word provided, generate a structured psychological pedagogical report in JSON format.
        Identify Word Nature as Positive, Neutral, or Negative.
        Identify specific Officer Like Qualities (OLQs) such as Determination, Social Adjustment, Courage, Sense of Responsibility, Emotional Stability, etc.
        Explain the 3-second mental shift required (e.g., from 'Problem' to 'Solution').
        Provide sentence-making logic (Formula: Action + Result or Attitude + Responsibility).
        List common weak 'Reject' level responses with reasoning.
        Provide FOUR short (4-6 words) ideal officer responses that demonstrate leadership, resilience, and initiative.`;

        // State
        let timedMode = false;
        let timer = 10;
        let timerInterval = null;
        let history = JSON.parse(localStorage.getItem('wat_history') || '[]');

        // DOM Elements
        const watForm = document.getElementById('wat-form');
        const wordInput = document.getElementById('word-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const timedToggle = document.getElementById('timed-mode-toggle');
        const toggleKnob = document.getElementById('toggle-knob');
        const inputSection = document.getElementById('input-section');
        const reportArea = document.getElementById('report-area');
        const timerContainer = document.getElementById('timer-container');
        const timerCircle = document.getElementById('timer-circle');
        const nextWordBtn = document.getElementById('next-word-btn');
        const historyContainer = document.getElementById('history-container');
        const historyList = document.getElementById('history-list');

        async function getWATBreakdown(word) {
            // Environment variable access provided by the system
            const ai = new GoogleGenAI({ apiKey: window.process?.env?.API_KEY || '' });
            const response = await ai.models.generateContent({
                model: "gemini-3-flash-preview",
                contents: `Analyze the word: "${word}" for ISSB WAT training.`,
                config: {
                    systemInstruction: SYSTEM_INSTRUCTION,
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: Type.OBJECT,
                        properties: {
                            word: { type: Type.STRING },
                            nature: { type: Type.STRING, enum: ["Positive", "Neutral", "Negative"] },
                            natureReasoning: { type: Type.STRING },
                            olqs: { type: Type.ARRAY, items: { type: Type.STRING } },
                            thinkingDirection: { type: Type.STRING },
                            sentenceLogic: {
                                type: Type.OBJECT,
                                properties: {
                                    formula: { type: Type.STRING },
                                    avoid: { type: Type.ARRAY, items: { type: Type.STRING } }
                                },
                                required: ["formula", "avoid"]
                            },
                            weakResponses: {
                                type: Type.ARRAY,
                                items: {
                                    type: Type.OBJECT,
                                    properties: {
                                        response: { type: Type.STRING },
                                        reason: { type: Type.STRING }
                                    },
                                    required: ["response", "reason"]
                                }
                            },
                            idealResponses: { type: Type.ARRAY, items: { type: Type.STRING } }
                        },
                        required: ["word", "nature", "natureReasoning", "olqs", "thinkingDirection", "sentenceLogic", "weakResponses", "idealResponses"]
                    }
                }
            });
            return JSON.parse(response.text);
        }

        function startTimer() {
            clearInterval(timerInterval);
            timer = 10;
            timerContainer.classList.remove('hidden');
            updateTimerUI();
            
            timerInterval = setInterval(() => {
                timer--;
                updateTimerUI();
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    reportArea.classList.add('blur-md', 'pointer-events-none', 'opacity-50');
                }
            }, 1000);
        }

        function updateTimerUI() {
            timerCircle.innerText = timer;
            if (timer < 4) {
                timerCircle.classList.add('timer-critical');
            } else {
                timerCircle.classList.remove('timer-critical');
            }
        }

        function renderReport(data) {
            // Nature
            const badge = document.getElementById('nature-badge');
            badge.innerText = `${data.nature} Nature`;
            badge.className = `px-3 py-1 rounded-md text-[10px] font-bold border uppercase tracking-wider nature-${data.nature.toLowerCase()}`;
            
            document.getElementById('nature-reasoning').innerText = data.natureReasoning;
            
            // OLQs
            const olqContainer = document.getElementById('olq-container');
            olqContainer.innerHTML = data.olqs.map(olq => `
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-indigo-500/20 text-indigo-300 border border-indigo-500/30">
                    ${olq}
                </span>
            `).join('');

            document.getElementById('thinking-direction').innerText = `"${data.thinkingDirection}"`;
            document.getElementById('formula').innerText = data.sentenceLogic.formula;
            
            // Avoid List
            document.getElementById('avoid-list').innerHTML = data.sentenceLogic.avoid.map(item => `
                <li class="text-xs text-slate-500 flex items-center gap-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-rose-500"></span> ${item}
                </li>
            `).join('');

            // Weak Responses
            document.getElementById('weak-responses').innerHTML = data.weakResponses.map(weak => `
                <div class="bg-slate-900/50 p-3 rounded-xl border border-slate-800">
                    <p class="text-slate-500 line-through text-sm italic mb-1">"${weak.response}"</p>
                    <p class="text-[10px] text-rose-300/60 uppercase font-semibold">${weak.reason}</p>
                </div>
            `).join('');

            // Ideal Responses
            document.getElementById('ideal-responses').innerHTML = data.idealResponses.map((res, i) => `
                <div class="bg-slate-900/80 p-4 rounded-xl border border-indigo-500/20 flex items-center hover:border-indigo-500/50 transition-colors">
                    <span class="text-indigo-500/50 font-mono text-xs mr-3">0${i+1}</span>
                    <p class="text-lg font-bold text-white montserrat">"${res}"</p>
                </div>
            `).join('');

            // Animations
            inputSection.classList.remove('translate-y-24');
            inputSection.classList.add('translate-y-0');
            reportArea.classList.remove('hidden');
            setTimeout(() => {
                reportArea.classList.remove('opacity-0');
                reportArea.classList.add('opacity-100');
            }, 50);
        }

        function updateHistory(word) {
            if (!history.includes(word)) {
                history = [word, ...history].slice(0, 10);
                localStorage.setItem('wat_history', JSON.stringify(history));
            }
            renderHistory();
        }

        function renderHistory() {
            if (history.length === 0) {
                historyContainer.classList.add('hidden');
                return;
            }
            historyContainer.classList.remove('hidden');
            historyList.innerHTML = history.map(word => `
                <button class="px-4 py-2 rounded-full bg-slate-800 text-slate-400 text-xs hover:bg-slate-700 hover:text-white transition-all border border-slate-700">
                    ${word}
                </button>
            `).join('');

            historyList.querySelectorAll('button').forEach(btn => {
                btn.onclick = () => {
                    wordInput.value = btn.innerText;
                    watForm.dispatchEvent(new Event('submit'));
                };
            });
        }

        // Event Listeners
        timedToggle.onclick = () => {
            timedMode = !timedMode;
            timedToggle.classList.toggle('bg-indigo-600', timedMode);
            timedToggle.classList.toggle('bg-slate-700', !timedMode);
            toggleKnob.style.left = timedMode ? '24px' : '4px';
        };

        watForm.onsubmit = async (e) => {
            e.preventDefault();
            const word = wordInput.value.trim();
            if (!word) return;

            analyzeBtn.disabled = true;
            analyzeBtn.innerText = '...';
            
            try {
                const data = await getWATBreakdown(word);
                renderReport(data);
                updateHistory(word);
                if (timedMode) startTimer();
            } catch (err) {
                console.error(err);
                alert("Psychologist AI unavailable. Check API connectivity.");
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerText = 'ANALYZE';
            }
        };

        nextWordBtn.onclick = () => {
            clearInterval(timerInterval);
            timerContainer.classList.add('hidden');
            reportArea.classList.add('opacity-0');
            reportArea.classList.remove('opacity-100');
            setTimeout(() => {
                reportArea.classList.add('hidden');
                inputSection.classList.add('translate-y-24');
                inputSection.classList.remove('translate-y-0');
                wordInput.value = '';
                wordInput.focus();
            }, 500);
        };
        
        renderHistory();
    </script>
</body>
</html>